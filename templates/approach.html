{% extends "base_public.html" %}

{% block title %}Our Approach — EFP Wealth{% endblock %}
{% block description %}Multi-factor quantitative model with regime-aware allocation and walk-forward validation. A systematic, rules-based investment process.{% endblock %}

{% block head %}
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
{% endblock %}

{% block content %}

{% set h = metrics.get('hero', {}) %}
{% set c = content.get('approach', {}) %}

<!-- Page Header -->
<div class="page-header">
  <div class="container">
    <h1>{{ c.get('page_title', 'Our Approach') }}</h1>
    <p>{{ c.get('page_subtitle', 'A systematic, rules-based investment process combining factor-based stock selection, regime-aware allocation, and rigorous out-of-sample validation.') }}</p>
  </div>
</div>

<!-- Philosophy -->
<section class="section">
  <div class="container">
    <div class="prose" style="margin-bottom: 64px;">
      <h2 style="margin-bottom: 16px;">Investment Philosophy</h2>
      {% for para in c.get('philosophy_paragraphs', []) %}
      <p>{{ para | safe }}</p>
      {% endfor %}
    </div>

    <!-- Multi-Factor Model — Icon Cards -->
    <h2 class="section-title" style="margin-bottom: 8px;">{{ c.get('factor_section_title', 'Multi-Factor Stock Selection') }}</h2>
    <p class="section-subtitle" style="margin-bottom: 32px;">
      {{ c.get('factor_section_subtitle', 'Stocks from the NIFTY LargeMidcap 250 universe are ranked across four factor categories. Top 20 stocks by composite score are selected, conviction-weighted, and rebalanced monthly.') }}
    </p>

    <div class="factor-icon-grid">
      <!-- Momentum -->
      <div class="factor-icon-card">
        <div class="factor-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="#C59A2C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
            <polyline points="17 6 23 6 23 12"></polyline>
          </svg>
        </div>
        <h4>Momentum</h4>
        <p>{{ c.get('factor_categories', [{}])[0].get('description', 'Multiple timeframe price and earnings momentum signals') if c.get('factor_categories') else 'Multiple timeframe price and earnings momentum signals' }}</p>
      </div>
      <!-- Quality -->
      <div class="factor-icon-card">
        <div class="factor-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="#C59A2C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            <polyline points="9 12 11 14 15 10"></polyline>
          </svg>
        </div>
        <h4>Quality</h4>
        <p>{{ c.get('factor_categories', [{}]*2)[1].get('description', 'Profitability, capital efficiency, and balance sheet strength') if c.get('factor_categories') and c.get('factor_categories')|length > 1 else 'Profitability, capital efficiency, and balance sheet strength' }}</p>
      </div>
      <!-- Value -->
      <div class="factor-icon-card">
        <div class="factor-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="#C59A2C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="1" x2="12" y2="23"></line>
            <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
          </svg>
        </div>
        <h4>Value</h4>
        <p>{{ c.get('factor_categories', [{}]*3)[2].get('description', 'Earnings-based valuation attractiveness') if c.get('factor_categories') and c.get('factor_categories')|length > 2 else 'Earnings-based valuation attractiveness' }}</p>
      </div>
      <!-- Low Volatility -->
      <div class="factor-icon-card">
        <div class="factor-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="#C59A2C" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
        </div>
        <h4>Low Volatility</h4>
        <p>{{ c.get('factor_categories', [{}]*4)[3].get('description', 'Risk-reduction tilt toward stable names') if c.get('factor_categories') and c.get('factor_categories')|length > 3 else 'Risk-reduction tilt toward stable names' }}</p>
      </div>
    </div>

    <!-- Regime-Aware Allocation -->
    <h2 class="section-title" style="margin-bottom: 8px; margin-top: 64px;">{{ c.get('regime_title', 'Regime-Aware Allocation') }}</h2>
    <p class="section-subtitle" style="margin-bottom: 32px;">
      {{ c.get('regime_subtitle', 'A multi-signal ensemble detects market regimes on a continuous scale. The allocation between equities, gold, and debt shifts dynamically based on regime conviction.') }}
    </p>

    <div class="chart-container" style="margin-bottom: 64px;">
      <div class="chart-title">{{ c.get('allocation_chart_title', 'Historical Asset Allocation') }}</div>
      <div class="chart-subtitle">
        {{ c.get('allocation_chart_subtitle', 'Dynamic allocation across equities, gold, and debt based on regime confidence score. Each bar represents a monthly rebalance point.') }}
      </div>
      <div class="chart-canvas-wrap" style="height: 320px;">
        <canvas id="allocationChart"></canvas>
      </div>
    </div>

    <!-- Walk-Forward Validation -->
    <h2 class="section-title" style="margin-bottom: 8px;">{{ c.get('wf_section_title', 'Walk-Forward Validation') }}</h2>
    <p class="section-subtitle" style="margin-bottom: 32px;">
      {{ c.get('wf_section_subtitle', 'The strongest test of any investment strategy is whether it works on data it has never seen. We use walk-forward validation — the gold standard in systematic trading research.') }}
    </p>

    <div class="wf-diagram">
      <h4 style="margin-bottom: 16px;">17 Non-Overlapping Train/Test Windows</h4>
      {% for i in range(6) %}
      <div class="wf-bar-row">
        <div class="wf-bar-label">W{{ i + 1 }}</div>
        <div class="wf-bar-train" style="width: {{ 40 - i * 2 }}%;"></div>
        <div class="wf-bar-test" style="width: {{ 12 }}%;"></div>
        <span style="font-size: 11px; color: var(--gray-400); margin-left: 8px;">
          {% if i == 0 %}2015-2017 train &rarr; 2017 H1 test
          {% elif i == 1 %}2015-2017.5 train &rarr; 2017 H2 test
          {% elif i == 2 %}2016-2018 train &rarr; 2018 H1 test
          {% elif i == 3 %}2016-2018.5 train &rarr; 2018 H2 test
          {% elif i == 4 %}2017-2019 train &rarr; 2019 H1 test
          {% elif i == 5 %}... through Window 17 &rarr; 2025 H2 test
          {% endif %}
        </span>
      </div>
      {% endfor %}
      <div class="wf-legend">
        <span><span class="wf-legend-dot" style="background: var(--navy); opacity: 0.7;"></span> Training period (2 years)</span>
        <span><span class="wf-legend-dot" style="background: var(--gold);"></span> Out-of-sample test (6 months)</span>
      </div>
    </div>

    <div class="prose" style="margin-top: 32px;">
      <p>{{ c.get('wf_description', '') | safe }}</p>
      <p>{{ c.get('wf_survivorship', '') | safe }}</p>
    </div>

  </div>
</section>

{% endblock %}

{% block scripts %}
<script type="application/json" id="allocationData">{{ allocation_json | safe }}</script>
<script>
(function() {
  var raw = JSON.parse(document.getElementById('allocationData').textContent);
  if (!raw || !raw.dates) return;

  var ctx = document.getElementById('allocationChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: raw.dates,
      datasets: [
        {
          label: 'Equity',
          data: raw.equity_pct,
          backgroundColor: '#C59A2C',
          borderWidth: 0,
        },
        {
          label: 'Gold',
          data: raw.gold_pct,
          backgroundColor: '#F59E0B',
          borderWidth: 0,
        },
        {
          label: 'Debt',
          data: raw.debt_pct,
          backgroundColor: '#94A3B8',
          borderWidth: 0,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          position: 'top',
          align: 'end',
          labels: {
            font: { family: "'Inter', sans-serif", size: 12 },
            color: '#64748B',
            padding: 20
          }
        },
        tooltip: {
          backgroundColor: '#1B2A4A',
          bodyFont: { family: "'JetBrains Mono', monospace", size: 12 },
          padding: 12,
          callbacks: {
            label: function(ctx) {
              return ctx.dataset.label + ': ' + ctx.parsed.y.toFixed(1) + '%';
            }
          }
        }
      },
      scales: {
        x: {
          type: 'time',
          time: { unit: 'quarter', displayFormats: { quarter: "MMM ''yy" } },
          stacked: true,
          grid: { display: false },
          ticks: {
            font: { family: "'Inter', sans-serif", size: 11 },
            color: '#94A3B8'
          }
        },
        y: {
          stacked: true,
          max: 100,
          grid: { color: '#F1F5F9' },
          ticks: {
            font: { family: "'JetBrains Mono', monospace", size: 11 },
            color: '#94A3B8',
            callback: function(v) { return v + '%'; }
          }
        }
      }
    }
  });
})();
</script>
{% endblock %}
