{% extends "base.html" %}
{% block title %}Current Signals — EFP Wealth{% endblock %}
{% block content %}
<div style="width:100%;max-width:960px;">
    <h2 style="font-size:24px;font-weight:700;margin-bottom:8px;">Current Portfolio Signals</h2>
    <p style="color:#64748b;font-size:14px;margin-bottom:32px;">Monthly rebalance recommendations for {{ user.name }}.</p>

    {% if signals %}
    <!-- Regime & Allocation -->
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:24px;">
        <div style="background:#1B2A4A;border-radius:12px;padding:24px;text-align:center;">
            <div style="color:#64748b;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:8px;">Regime Confidence</div>
            <div style="font-size:36px;font-weight:700;color:{% if signals.regime_confidence > 0.3 %}#34d399{% elif signals.regime_confidence > -0.3 %}#fbbf24{% else %}#f87171{% endif %}">
                {{ "%.2f"|format(signals.regime_confidence) }}
            </div>
            <div style="color:#94a3b8;font-size:12px;margin-top:4px;">
                {% if signals.regime_confidence > 0.3 %}Bullish{% elif signals.regime_confidence > -0.3 %}Neutral{% else %}Bearish{% endif %}
            </div>
        </div>
        <div style="background:#1B2A4A;border-radius:12px;padding:24px;">
            <div style="color:#64748b;font-size:12px;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px;">Asset Allocation</div>
            <div style="display:flex;gap:16px;justify-content:center;">
                <div style="text-align:center;">
                    <div style="font-size:24px;font-weight:700;color:#60a5fa;">{{ signals.allocation.equity }}%</div>
                    <div style="color:#94a3b8;font-size:11px;">Equity</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:24px;font-weight:700;color:#fbbf24;">{{ signals.allocation.gold }}%</div>
                    <div style="color:#94a3b8;font-size:11px;">Gold</div>
                </div>
                <div style="text-align:center;">
                    <div style="font-size:24px;font-weight:700;color:#34d399;">{{ signals.allocation.debt }}%</div>
                    <div style="color:#94a3b8;font-size:11px;">Debt</div>
                </div>
            </div>
        </div>
    </div>

    <div style="color:#64748b;font-size:13px;margin-bottom:16px;">
        Signal date: <strong style="color:#1B2A4A;">{{ signals.date }}</strong>
        &middot; Next rebalance: <strong style="color:#1B2A4A;">{{ signals.next_rebalance or 'TBD' }}</strong>
    </div>

    <!-- Portfolio table -->
    <div style="background:#ffffff;border:1px solid #e2e8f0;border-radius:12px;overflow:hidden;">
        <table style="width:100%;border-collapse:collapse;font-size:14px;">
            <thead>
                <tr style="background:#f1f5f9;">
                    <th style="padding:12px 16px;text-align:left;font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;">#</th>
                    <th style="padding:12px 16px;text-align:left;font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;">Symbol</th>
                    <th style="padding:12px 16px;text-align:right;font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;">Weight</th>
                    <th style="padding:12px 16px;text-align:left;font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;">Sector</th>
                    <th style="padding:12px 16px;text-align:right;font-size:12px;color:#64748b;text-transform:uppercase;letter-spacing:0.5px;">Factor Score</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in signals.portfolio %}
                <tr style="border-top:1px solid #f1f5f9;">
                    <td style="padding:10px 16px;color:#94a3b8;">{{ loop.index }}</td>
                    <td style="padding:10px 16px;font-weight:600;">{{ stock.symbol }}</td>
                    <td style="padding:10px 16px;text-align:right;color:#C59A2C;font-weight:600;">{{ "%.1f"|format(stock.weight) }}%</td>
                    <td style="padding:10px 16px;color:#64748b;">{{ stock.sector or '—' }}</td>
                    <td style="padding:10px 16px;text-align:right;">{{ "%.2f"|format(stock.score) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    {% if signals.changes %}
    <div style="margin-top:24px;background:#ffffff;border:1px solid #e2e8f0;border-radius:12px;padding:20px;">
        <h3 style="font-size:14px;font-weight:600;color:#1B2A4A;margin-bottom:12px;">Rebalance Changes</h3>
        {% if signals.changes.buy %}
        <div style="margin-bottom:8px;">
            <span style="color:#34d399;font-weight:600;font-size:13px;">BUY:</span>
            <span style="color:#475569;font-size:13px;">{{ signals.changes.buy | join(', ') }}</span>
        </div>
        {% endif %}
        {% if signals.changes.sell %}
        <div>
            <span style="color:#f87171;font-weight:600;font-size:13px;">SELL:</span>
            <span style="color:#475569;font-size:13px;">{{ signals.changes.sell | join(', ') }}</span>
        </div>
        {% endif %}
    </div>
    {% endif %}

    <div style="margin-top:24px;padding:16px;background:#fffbeb;border:1px solid #fde68a;border-radius:8px;font-size:12px;color:#92400e;line-height:1.5;">
        This is not investment advice. All recommendations are model-generated based on quantitative factors.
        Past performance does not guarantee future results. Please consult your financial advisor before acting on these signals.
    </div>

    {% else %}
    <div style="background:#ffffff;border:1px solid #e2e8f0;border-radius:12px;padding:60px 24px;text-align:center;">
        <div style="font-size:48px;margin-bottom:16px;">&#x1F4CA;</div>
        <h3 style="font-size:18px;color:#1B2A4A;margin-bottom:8px;">No Signals Available Yet</h3>
        <p style="color:#64748b;font-size:14px;">Current month's portfolio signals will be published after the next rebalance date.</p>
    </div>
    {% endif %}
</div>

<style>
@media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 1fr"] { grid-template-columns: 1fr !important; }
    table { display: block; overflow-x: auto; }
}
</style>
{% endblock %}
